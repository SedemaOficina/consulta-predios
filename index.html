<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor de Suelo de Conservaci贸n | SEDEMA</title>
    
    <!-- FUENTES OFICIALES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cabin:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- CSS del Buscador -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    
    <!-- NUESTRO ESTILO -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- 1. ENCABEZADO OFICIAL -->
    <header class="gob-header">
        <div class="header-inner">
            <!-- LOGO ACTUALIZADO -->
            <img src="logo-sedema.png" alt="Logo SEDEMA" class="logo-cdmx">
            
            <div class="vertical-line"></div>
            
            <div class="dependency-name">
                <h1>SECRETARA DEL<br>MEDIO AMBIENTE</h1>
            </div>
        </div>
        
        <nav class="nav-links">
            <a href="#" class="nav-item">Inicio</a>
            <a href="#" class="nav-item">Ayuda</a>
        </nav>
    </header>

    <!-- 2. CONTENEDOR PRINCIPAL -->
    <main class="layout-container">
        
        <!-- MAPA -->
        <div id="map"></div>

        <!-- BOTN DE UBICACIN (GPS) -->
        <button id="btn-locate" class="btn-gps" title="Ubicar mi posici贸n">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="3"></circle>
                <line x1="12" y1="2" x2="12" y2="4"></line>
                <line x1="12" y1="20" x2="12" y2="22"></line>
                <line x1="2" y1="12" x2="4" y2="12"></line>
                <line x1="20" y1="12" x2="22" y2="12"></line>
            </svg>
        </button>

        <!-- TARJETA FLOTANTE -->
        <div class="info-card">
            <div class="card-header">
                <h2>Consulta de Predios</h2>
            </div>
            
            <div class="card-body">
                <p class="roboto-text">
                    Verifique si un terreno se encuentra en <b>Zona de Conservaci贸n</b> antes de realizar cualquier tr谩mite o pago.
                </p>

                <!-- El buscador ahora estar谩 dentro del mapa, pero dejamos este texto de ayuda -->
                <p style="font-size: 12px; color:#666; margin-bottom: 5px;">
                    <i>Tip: Puede buscar por calle o coordenada (Ej: 19.25, -99.10) en la lupa del mapa.</i>
                </p>

                <div class="separator"></div>

                <h3>Simbolog铆a Oficial</h3>
                
                <div class="legend-item">
                    <span class="color-box guinda-fill"></span>
                    <div>
                        <span class="legend-title">Suelo de Conservaci贸n</span>
                        <span class="legend-desc">Venta prohibida (Delito Ambiental)</span>
                    </div>
                </div>

                <div class="legend-item">
                    <span class="color-box verde-fill"></span>
                    <div>
                        <span class="legend-title">rea Natural Protegida</span>
                        <span class="legend-desc">Bosques y Barrancas (Federal/Local)</span>
                    </div>
                </div>

                <div class="alert-banner">
                    <span class="alert-icon">锔</span>
                    <p>
                        <strong>隆ALTO AL FRAUDE!</strong><br>
                        Si le venden terrenos en zonas coloreadas, 
                        denuncie al 911 o en PAOT.
                    </p>
                </div>
            </div>
            
            <div class="card-footer">
                <small>Gobierno de la Ciudad de M茅xico 2024-2030</small>
            </div>
        </div>

    </main>

    <!-- SCRIPTS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    
    <script>
        // --- 1. DEFINICIN DE CAPAS BASE (FONDOS) ---
        
        // Opci贸n A: Gris (Elegante/Institucional)
        var mapaGris = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '漏 OpenStreetMap, 漏 CARTO'
        });

        // Opci贸n B: Sat茅lite (Esri World Imagery) - Para ver el bosque real
        var mapaSatelite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles 漏 Esri'
        });

        // Opci贸n C: Calles (OpenStreetMap) - Para ver nombres de tiendas y calles
        var mapaCalles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '漏 OpenStreetMap'
        });

        // Inicializamos el mapa con la capa GRIS por defecto
        var map = L.map('map', { 
            zoomControl: false,
            layers: [mapaGris] // Capa inicial
        }).setView([19.30, -99.15], 11);

        // Control de Zoom a la derecha
        L.control.zoom({ position: 'topright' }).addTo(map);

        // --- 2. CONTROL DE CAPAS (Selector de Fondos) ---
        var baseMaps = {
            "Mapa Institucional (Gris)": mapaGris,
            "Vista Satelital": mapaSatelite,
            "Mapa de Calles": mapaCalles
        };
        // Agregamos el control abajo a la derecha
        L.control.layers(baseMaps).addTo(map);


        // --- 3. BUSCADOR INTELIGENTE (Direcciones y Coordenadas) ---
        var geocoder = L.Control.geocoder({
            defaultMarkGeocode: false,
            placeholder: "Buscar calle o coordenadas...",
            geocoder: L.Control.Geocoder.nominatim() // Usa OSM para predecir
        })
        .on('markgeocode', function(e) {
            var bbox = e.geocode.bbox;
            var poly = L.polygon([
                bbox.getSouthEast(),
                bbox.getNorthEast(),
                bbox.getNorthWest(),
                bbox.getSouthWest()
            ]);
            map.fitBounds(poly.getBounds());
            
            // Poner un marcador en el resultado
            L.marker(e.geocode.center).addTo(map)
                .bindPopup("<b>Ubicaci贸n Buscada</b><br>" + e.geocode.name).openPopup();
        })
        .addTo(map);


        // --- 4. FUNCIN GPS (Bot贸n Ubicarme) ---
        document.getElementById('btn-locate').addEventListener('click', function() {
            // Pedir al navegador la ubicaci贸n
            map.locate({setView: true, maxZoom: 16});
        });

        // Si encuentra la ubicaci贸n:
        map.on('locationfound', function(e) {
            var radius = e.accuracy;
            
            L.marker(e.latlng).addTo(map)
                .bindPopup(" 隆Est谩s aqu铆!").openPopup();

            L.circle(e.latlng, radius).addTo(map);
        });

        // Si hay error (ej. el usuario niega el permiso):
        map.on('locationerror', function(e) {
            alert("No pudimos acceder a tu ubicaci贸n. Aseg煤rate de tener el GPS activado y dar permisos al navegador.");
        });


        // --- 5. TUS CAPAS (Simulaci贸n) ---
        // Aqu铆 ir谩n tus GeoJSON reales. Dejo el pol铆gono de ejemplo.
        var poligonoProhibido = L.polygon([
            [19.28, -99.18], [19.29, -99.05], [19.20, -99.08], [19.20, -99.20]
        ], {
            color: '#9d2148',
            fillColor: '#9d2148',
            fillOpacity: 0.5,
            weight: 2
        }).addTo(map);

        poligonoProhibido.bindPopup(`
            <div style="font-family: 'Roboto', sans-serif; text-align:center;">
                <h3 style="font-family:'Cabin', sans-serif; color:#9d2148; margin-bottom:5px;">ZONA RESTRINGIDA</h3>
                <p style="margin:0;">Suelo de Conservaci贸n</p>
                <br>
                <button style="background:#9d2148; color:white; border:none; padding:8px 12px; border-radius:4px;">VER DETALLES</button>
            </div>
        `);

    </script>
</body>
</html>
